# ZH增强编辑插件项目结构说明

本文档详细说明了现有的项目结构、功能分类及核心模块职责。

## 1. 目录结构详解

项目的核心代码位于 `src` 目录下，采用 Typescript 编写，通过 esbuild 打包为单一的 `main.js`。

```text
ZH增强编辑/
├── src/                       # 源代码目录
│   ├── data/                  # 静态数据与常量
│   │   └── char-tables.ts     # 简繁体转换对照表
│   ├── features/              # 功能逻辑实现
│   │   └── all-features.ts    # [核心] 包含所有增强编辑功能的具体实现
│   ├── utils/                 # 通用工具函数
│   │   └── editor.ts          # 编辑器相关的底层辅助函数 (如获取选区信息)
│   ├── main.ts                # [入口] 插件主类，负责初始化与命令注册
│   ├── settings.ts            # 设置数据结构定义 (Settings 类)
│   ├── settings-tab.ts        # 设置面板 UI 实现 (EditSettingsTab 类)
│   ├── globals.ts             # 全局变量类型声明
│   └── types.ts               # 项目内共享的 TS 类型定义
├── text/                      # 项目文档目录
├── package.json               # NPM 依赖管理
├── tsconfig.json              # TypeScript 编译配置
├── esbuild.config.mjs         # esbuild 打包配置脚本
└── manifest.json              # Obsidian 插件清单文件
```

## 2. 功能分类

插件包含约 70+ 个功能函数，主要集中在 `src/features/all-features.ts` 中，按功能逻辑可分为以下几类：

### 2.1 文本编辑增强
*   **格式转换**: 粗体、斜体、高亮、删除线、下划线、行内代码、代码块 (`转换粗体` 等)
*   **标点与符号**: 智能符号、英转中文标点、中转英文标点 (`智能符号` 等)
*   **空格与缩进**: 首行缩进、去除空格、中英间隔处理 (`首行缩进两字符`, `去除所有空格`)
*   **空行处理**: 批量插入/去除空行 (`批量插入空行`)

### 2.2 链接与引用
*   **链接转换**: 内部链接转换、同义链接、超链接语法 (`转换内部链接`, `转为超链接语法`)
*   **文本括选**: 快速添加括号/书名号等 (`括选文本1-4`)

### 2.3 光标与导航
*   **光标移动**: 上下左右移动、置首/置尾 (`游标上移` 等)
*   **智能跳转**: 基于语法的快速跳转 (`光标跳转`)
*   **文件切换**: 快速切换同级目录下的上/下文件 (`切换文件列表`)

### 2.4 内容操作
*   **选择**: 选择整句、整段、当前语法区域 (`选择当前整段`, `选择当前语法`)
*   **提取与粘贴**: 智能粘贴、获取富文本 (HTML)、获取无语法文本
*   **搜索修复**: 搜索当前文本、修复意外断行

### 2.5 其他工具
*   **标题管理**: 快速设置 H1-H6、自动设置标题 (`标题语法`, `自动设置标题`)
*   **文件操作**: 指定文件名、获取相对路径 (`指定当前文件名`)
*   **简繁转换**: 简体转繁体、繁体转简体

## 3. 核心模块说明

该项目采用了 **"Wrapper - Logic" (包装器 - 逻辑)** 的分层架构。

### 3.1 `src/main.ts` (包装器)
这是插件的**管理者**。
*   **职责**:
    1.  继承 `Plugin` 基类，管理插件生命周期 (`onload`, `onunload`)。
    2.  加载与保存用户设置 (`Settings`)。
    3.  **注册命令 (Add Commands)**: 将用户的操作（如按键、命令面板调起）映射到具体的功能函数。
    4.  **注册事件**: 监听编辑器变化、鼠标/键盘事件。
    5.  **初始化上下文**: 将 `app` 和 `settings` 实例注入到功能模块中。
*   **特点**: 轻量级，不包含具体的文本处理逻辑，只负责"指挥"。

### 3.2 `src/features/all-features.ts` (逻辑核心)
这是插件的**工作者**。
*   **职责**:
    1.  包含了所有具体的业务逻辑实现。
    2.  直接操作 Obsidian 的 `Editor` 接口进行文本读写。
    3.  维护操作所需的局部全局状态（如 `笔记全文`, `当前行号`, `选至行首` 等编辑器上下文），这些状态通过 `获取编辑器信息()` 动态更新。
*   **设计**: 为了方便从旧代码迁移并保持功能间的紧密耦合（许多功能共享相同的编辑器上下文分析），目前采用单文件模块化。

### 3.3 `src/utils/editor.ts` (基础设施)
*   **职责**: 提供底层的编辑器信息提取能力。主要负责计算光标位置、获取当前行内容、判断前/后文环境等，供 `all-features.ts` 调用。
